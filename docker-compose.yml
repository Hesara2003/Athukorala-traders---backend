version: '3.8'

services:
  # Spring Boot Application
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: athukorala-traders-backend
    ports:
      - "8080:8080"
    environment:
      # MongoDB Configuration (using external MongoDB Atlas)
      SPRING_DATA_MONGODB_URI: ${SPRING_DATA_MONGODB_URI:-mongodb+srv://hesarap68_db_user:KFhGLlBdKsGuug02@athukorala-traders.sn1ax38.mongodb.net/?retryWrites=true&w=majority&appName=Athukorala-Traders}
      SPRING_DATA_MONGODB_DATABASE: ${SPRING_DATA_MONGODB_DATABASE:-athukorala_traders_db}
      
      # Mail Configuration
      MAIL_HOST: ${MAIL_HOST:-smtp.example.com}
      MAIL_PORT: ${MAIL_PORT:-587}
      MAIL_USERNAME: ${MAIL_USERNAME}
      MAIL_PASSWORD: ${MAIL_PASSWORD}
      
      # Google OAuth Configuration
      GOOGLE_OAUTH_CLIENT_ID: ${GOOGLE_OAUTH_CLIENT_ID:-869175912443-dldas4e1kkkc6v1cqbptfcnst5ktc3l9.apps.googleusercontent.com}
      GOOGLE_OAUTH_CLIENT_SECRET: ${GOOGLE_OAUTH_CLIENT_SECRET:-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}
      
      # Spring Profile
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-prod}
    volumes:
      # Persist uploaded files
      - ./uploads:/app/uploads
    restart: unless-stopped
    networks:
      - app-network
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  app-network:
    driver: bridge

volumes:
  uploads:
    driver: local
